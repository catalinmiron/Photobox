/**
 * @file: photobox.min.js
 *
 * Author: Mikita Stankiewicz
 * URL: http://designed.bymikita.com/photobox/
 * Version: 0.4
 */

;(function($,window,document,undefined){var Photobox=function(items,options){this.$items=$(items);this.options=options;};Photobox.prototype={cache:[],items:[],current:0,isGallery:true,useDots:false,defaults:{},options:{},config:{},init:function(){this.config=$.extend({},this.defaults,this.options);if($().dots)
this.useDots=true;var self=this;this.$items.each(function(n){self.items.push($(this).attr('href'));$(this).click(function(e){e.preventDefault();self.open(n);});});},load:function(n){this.title(n);if(''!=$('#photobox .photobox-placeholder').eq(n).html())
return;if(true==this.useDots)
$('#photobox .photobox-placeholder').eq(n).dots();var src=this.$items.eq(n).attr('href');function i(){if(true==this.useDots)
$('#photobox .photobox-placeholder').eq(n).dots('destroy');$('#photobox .photobox-placeholder').eq(n).html($('<img />').attr('src',src));setTimeout(function(){c();},1);$(window).resize(function(){c();});}
function c(){var placeholder=$('#photobox .photobox-placeholder').eq(n);var image=placeholder.find('img');image.css({'left':placeholder.width()/2-image.width()/2,'top':placeholder.height()/2-image.height()/2});}
if(-1!==$.inArray(src,this.cache))
return i();var self=this;var image=new Image();image.onload=function(){self.cache.push(src);i();};image.src=src;},title:function(n){var title=this.$items.eq(n).attr('title');$('#photobox .photobox-title span').text(title);},clear:function(){$('#photobox').remove();},setup:function(){this.clear();var self=this;$('body').append($('<div />').attr('id','photobox').css('opacity',0).append($('<div />').addClass('photobox-title').append($('<span />')).add($('<div />').addClass('photobox-controls').append($('<a />').attr('href','#').addClass('photobox-button-prev').append($('<span />')).add($('<a />').attr('href','#').addClass('photobox-button-close').append($('<span />'))).add($('<a />').attr('href','#').addClass('photobox-button-next').append($('<span />'))))).add($('<div />').addClass('photobox-wrapper'))));for(var i=0;i<this.items.length;i++)
$('#photobox .photobox-wrapper').append($('<div />').addClass('photobox-placeholder'));this.controls();this.keys();this.touchable();},controls:function(){var self=this;$('#photobox .photobox-button-prev').click(function(e){e.preventDefault();self.prev();});$('#photobox .photobox-button-next').click(function(e){e.preventDefault();self.next();});$('#photobox .photobox-button-close').click(function(e){e.preventDefault();self.close();});},keys:function(){var self=this;$(document).keydown(function(e){self.fadeoutMeta();switch(e.keyCode){case 37:self.prev();break;case 39:self.next();break;case 27:self.close();break;}});},touchable:function(){var self=this,offsetX=0,startX=0,width=$(window).width();$('#photobox .photobox-wrapper').bind('touchstart',function(e){$(this).removeClass('animate');offsetX=$(this).position().left;startX=e.originalEvent.touches[0].pageX;}).bind('touchmove',function(e){e.preventDefault();$(this).css('-webkit-transform','translateX('+(offsetX*-1+(startX-e.originalEvent.touches[0].pageX))*-1+'px)');}).bind('touchend',function(){var n=Math.round($(this).position().left/width)*-1;if(n<0)
n=0;if(n>self.items.length-1)
n=self.items.length-1;self.current=n;self.load(n);$(this).addClass('animate').css('-webkit-transform','translateX('+n*(width*-1)+'px)');});$('#photobox .photobox-placeholder img').bind('gesturechange',function(e){var scale=e.originalEvent.scale;if(0.5>scale)
scale=0.5;$(this).css('-webkit-transform','scale( '+scale+' )');});},open:function(n){this.setup();this.current=n;var offset=this.current*100*-1;$('#photobox .photobox-wrapper').css('left',offset+'%');this.load(n);$('#photobox').animate({opacity:1},100);},close:function(){this.clear();},prev:function(){if(!this.isGallery)
return false;this.current--;if(0>this.current)
this.current=0;this.load(this.current);var offset=this.current*($(window).width()*-1);$('.photobox-wrapper').addClass('animate').css('-webkit-transform','translateX('+offset+'px)');},next:function(){if(!this.isGallery)
return false;this.current++;if(this.items.length-1<this.current)
this.current=this.items.length-1;this.load(this.current);var offset=this.current*($(window).width()*-1);$('.photobox-wrapper').addClass('animate').css('-webkit-transform','translateX('+offset+'px)');},toggleMeta:function(){$('#photobox .photobox-title, #photobox .photobox-controls').fadeToggle(100);},fadeoutMeta:function(){$('#photobox .photobox-title, #photobox .photobox-controls').fadeOut(100);}};$.fn.photobox=function(options){new Photobox(this,options).init();return this;};})(jQuery,window,document);