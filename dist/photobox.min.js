/**
 * @file: photobox.js
 *
 * Author: Mikita Stankiewicz
 * URL: http://designed.bymikita.com/photobox/
 * Version: 0.1
 */

;(function($){function debug(mixed){var string='';if('object'==typeof mixed)
for(key in mixed)
string=string+key+' : '+mixed[key]+', ';else
string=mixed;$('#debug').text(string);}
var Photobox=function(items,options){this.$items=$(items);this.options=options;};Photobox.prototype={cache:[],items:[],current:0,is_gallery:true,defaults:{},options:{},config:{},init:function(){this.config=$.extend({},this.defaults,this.options);var PB=this;this.$items.each(function(n){PB.items.push($(this).attr('href'));$(this).click(function(e){e.preventDefault();PB.open(n);});});},load:function(n){this.title(n);if(''!=$('#photobox .photobox-placeholder').eq(n).html())
return;var src=this.$items.eq(n).attr('href');function i(){$('#photobox .photobox-placeholder').eq(n).html($('<img />').attr('src',src));setTimeout(function(){c();},1);$(window).resize(function(){c();});}
function c(){var placeholder=$('#photobox .photobox-placeholder').eq(n);var image=placeholder.find('img');image.css({'left':placeholder.width()/2-image.width()/2,'top':placeholder.height()/2-image.height()/2});}
if(-1!==$.inArray(src,this.cache))
return i();var PB=this;var image=new Image();image.onload=function(){PB.cache.push(src);i();};image.src=src;},title:function(n){var title=this.$items.eq(n).attr('title');$('#photobox .photobox-title span').text(title);},cleanup:function(){$('#photobox').remove();},setup:function(){this.cleanup();var PB=this;$('body').append($('<div />').attr('id','photobox').css('opacity',0).append($('<div />').addClass('photobox-title').append($('<span />')).add($('<div />').addClass('photobox-controls').append($('<a />').attr('href','#').addClass('photobox-button-prev').append($('<span />')).add($('<a />').attr('href','#').addClass('photobox-button-close').append($('<span />'))).add($('<a />').attr('href','#').addClass('photobox-button-next').append($('<span />'))))).add($('<div />').addClass('photobox-wrapper'))));for(var i=0;i<this.items.length;i++)
$('#photobox .photobox-wrapper').append($('<div />').addClass('photobox-placeholder'));this.controls();this.keys();this.touchable();$('.photobox-wrapper').bind('tap click',function(e){PB.toggle_meta();});},controls:function(){var PB=this;$('#photobox .photobox-button-prev').click(function(e){e.preventDefault();PB.prev();});$('#photobox .photobox-button-next').click(function(e){e.preventDefault();PB.next();});$('#photobox .photobox-button-close').click(function(e){e.preventDefault();PB.close();});},keys:function(){var PB=this;$(document).keydown(function(e){PB.fadeout_meta();switch(e.keyCode){case 37:PB.prev();break;case 39:PB.next();break;case 27:PB.close();break;}});},touchable:function(){var PB=this,offsetX=0,startX=0,width=$(window).width();$('#photobox .photobox-wrapper').bind('touchstart',function(e){$(this).removeClass('animate');offsetX=$(this).position().left;startX=e.originalEvent.touches[0].pageX;}).bind('touchmove',function(e){e.preventDefault();PB.fadeout_meta();console.log('touchmove',(offsetX*-1+(startX-e.originalEvent.touches[0].pageX))*-1+'px');$(this).css('left',(offsetX*-1+(startX-e.originalEvent.touches[0].pageX))*-1+'px');}).bind('touchend',function(){var n=Math.round($(this).position().left/width)*-1;console.log('touchend',$(this).position().left,width,$(this).position().left/width,n);if(n<0)
n=0;if(n>PB.items.length-1)
n=PB.items.length-1;PB.current=n;PB.load(n);$(this).addClass('animate').css('left',n*-100+'%');});},open:function(n){this.setup();this.current=n;var offset=this.current*100*-1;$('#photobox .photobox-wrapper').css('left',offset+'%');this.load(n);$('#photobox').animate({opacity:1},100);},close:function(){this.cleanup();},prev:function(){this.current--;if(0>this.current)
this.current=0;this.load(this.current);var offset=this.current*100*-1;$('.photobox-wrapper').addClass('animate').css('left',offset+'%');},next:function(){this.current++;if(this.items.length-1<this.current)
this.current=this.items.length-1;this.load(this.current);var offset=this.current*100*-1;$('.photobox-wrapper').addClass('animate').css('left',offset+'%');},toggle_meta:function(){$('#photobox .photobox-title, #photobox .photobox-controls').fadeToggle(100);},fadeout_meta:function(){$('#photobox .photobox-title, #photobox .photobox-controls').fadeOut(100);}};$.fn.photobox=function(options){new Photobox(this,options).init();return this;};})(jQuery);